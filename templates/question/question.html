{% extends 'base.html' %}
{% load static %}
{% load humanize %}
{% load bootstrap4 %}
{% block title %} Question {% endblock %}
{% block content %}
<br>
<br>
<br>
<br>
<div class="container mt-5 pt-3">
  <h1 class="py-3 mx-auto ms-3" style="color: #0053cb;" >{{ course.title }}</h1>
  <section>
    <div class="row">
      <div class="col-md-3 gx-5 mb-4">
        <div class="bg-light gy-5 text-center hover-overlay ripple shadow-2-strong rounded-5 ">
          
          <h4 class="border-scandary border-bottom py-4"><a href="{% url 'edit-course' course.id %}" class="text-decoration-none">Edit course</a></h4>
          <h4 class="border-scandary border-bottom py-4"><a href="{% url 'modules' course.id %}"class="text-decoration-none">units</a></h4>
          <h4 class="border-scandary border-bottom py-4"><a href="#sub"class="text-decoration-none">Submissions</a></h4>
          <h4 class="border-scandary border-bottom py-4"><a href="#leader"class="text-decoration-none">Leaderboard</a></h4>
          <h4 class="border-scandary border-bottom py-4"><a href="{% url 'questions' course.id %}" class="text-decoration-none">Questions</a></h4>
          {% if question.user.profile.user_type == 'teacher' %}
          <h4 class="border-scandary border-bottom py-4"><a href="{% url 'student-submissions' course.id %}"class="text-decoration-none">Student Submissions</a></h4>
          {% endif %}            
      </div>
      </div>
      <div class="col-md-8 gx-5 mb-4">
        <section class="container ">
          <div class=" gx-5 unit">
            <div class="section">
              <h4>Questions</h4>
            <div class="card">                      
              <div>
                {{ question.body | safe }}
              </div>
          
              <div>
                <div class="divider"></div>
                <h4><b>Asked by</b></h4>
              </div>
          
              <div class="col s12">
                <div class="card-panel grey lighten-5 z-depth-1">
          
                <div class="row">
                <div class="col s2">
                {% if question.user.profile.picture %}
                  <img src="{{ question.user.profile.picture.url }}" class="nav-img rounded-circle pe-1 " alt="photo" style="width: 50px;height: 50px;">
                {% else %}
                  <img src="{% static 'images/no_avatar.jpg' %}" class="nav-img rounded-circle pe-1 " alt="photo" style="width: 50px;height: 50px;">
                {% endif %}
                </div>
          
                <div class="col s10">
                  <p class="black-text"><b>{{ question.user.get_full_name }}</b> @{{ question.user.username }}</p>
                  <p class="black-text"><b>Asked: </b>{{question.created_date | naturaltime }}</p>
                </div>
                </div>
          
                </div>
              </div>
            </div>
              <div class="col s12">
                <h5><b>Answers: {{ answers.count }}</b></h5>
                <div class="divider"></div>
              </div>
              {% csrf_token %}
              <input type="hidden" name="url_path" value="{{ request.get_full_path }}">          
              <div class="col s12">
          
                {% for answer in answers %}
              <div class="card">
                <div class="col s12">
                <div class="card-panel grey lighten-5 z-depth-2">
          
                {% if answer.is_accepted_answer == True %}
                <div class="col s12 right-align">
                  <i class="material-icons medium green-text">done</i>
                </div>
                {% endif %}
          
                <div class="col s12">
                  {{ answer.body | safe }}
                </div>
          
                <div class="row">
                <div class="col s2">
                {% if answer.user.profile.picture %}
                  <img src="{{ answer.user.profile.picture.url }}" class="nav-img rounded-circle pe-1 " alt="photo" style="width: 50px;height: 50px;">
                {% else %}
                  <img src="{% static 'img/no_avatar.jpg' %}" class="nav-img rounded-circle pe-1 " alt="photo" style="width: 50px;height: 50px;">
                {% endif %}
                </div>
          
                <div class="col s10">
                  <p class="black-text"><b>{{ answer.user.get_full_name }}</b> @{{ answer.user.username }}</p>
                  <p class="black-text"><b>Answered: </b>{{answer.created_date | naturaltime }}</p>
                </div>
          
                <div class="col s12">
                  <a href="" class="vote" vote-type="U" answer-id="{{ answer.id }}"><i class="material-icons">thumb_up</i>Up vote</a>  
                  <a href="" class="vote" vote-type="D" answer-id="{{ answer.id }}"><i class="material-icons">thumb_down</i>Down vote</a> 
          
                  {% if moderator == True %}
                    <a href="{% url 'mark-as-answer' course.id question.id answer.id %}"><i class="material-icons">done</i>Mark as answer</a>
                  {% endif %}
          
                  <span class="card-title"><b>Votes</b></span>
                  <span id="answerVotes{{ answer.id }}" class="card-title"><b>{{ answer.votes }}</b></span>
          
                </div>
          
                </div>
          
                </div>
                </div>
              </div>
                {% endfor %}             
              </div>                    
              <div class="col s12">
                <h5><b>Your answer</b></h5>
                <div class="divider"></div>          
                <div class="card">
                  <form method="post" action="" role="form" class="col s12">
                    {% csrf_token %}
                    <div class="input-field col s12">
                      {{ form.body }}
                    </div>
                    <div class="input-field col s12">
                      <div class="mt-3">
                        <button class="btn btn-primary" type="submit" name="button">Add Answer</button>
                        <a class="btn btn-secondary" href="{% url 'questions' course.id %}">Cancel</a>
                      </div>
                    </div>
                    
                  </form>
                </div>          
              </div>          
              <div class="col s12 m12 center-align">
                {% if questions.has_previous %}
                  <a href="?page={{ questions.previous_page_number }}" class="btn"><i class="material-icons">arrow_back</i>Back</a>
                {% endif %}
          
                {% if questions.has_next %}
                  <a href="?page={{ questions.next_page_number }}" class="btn"><i class="material-icons">add</i>Load more</a>
                {% endif %}  
          
              </div>          
            </div>
         </div>
        </section>
      </div>
    </div>
  </section>
</div>
{% endblock %}